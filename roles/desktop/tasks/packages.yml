---
- name: Remove jack2 (conflicts with pipewire)
  community.general.pacman:
    name: jack2
    state: absent
  become: true

- name: Install desktop packages for selected desktops
  community.general.pacman:
    name: "{{ desktop_packages[item].packages }}"
    state: present
  loop: "{{ user.desktops }}"
  become: true

- name: Remove packages from desktops not in use
  community.general.pacman:
    name: "{{ item.value.packages }}"
    state: absent
  loop: "{{ desktop_packages | dict2items }}"
  when: item.key not in user.desktops
  failed_when: false
  become: true
